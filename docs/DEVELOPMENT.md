# Przewodnik Dewelopera - Bilet na Wsch√≥d

## üèóÔ∏è Architektura Projektu

### G≈Ç√≥wne Systemy

**Game Manager (`Scripts/game.gd`)**
- Centralne zarzƒÖdzanie stanem gry
- Kontrola przej≈õƒá miƒôdzy scenami i przep≈Çywu gry
- Globalne ustawienia i konfiguracja gry

**System Pasa≈ºer√≥w**
- `PassengerDataBus.gd` - Globalne zarzƒÖdzanie danymi pasa≈ºer√≥w
- `passenger.gd` - Zachowania indywidualnych pasa≈ºer√≥w
- `passenger_dialogue.gd` - System konwersacji

**System Dokument√≥w**
- `document_manager.gd` - Obs≈Çuga i weryfikacja dokument√≥w
- `ticket_control.gd` - Logika walidacji bilet√≥w
- `fine.gd` - System wystawiania mandat√≥w

**Systemy UI**
- HUD zarzƒÖdzania stresem
- System podrƒôcznika i referencji
- Interfejs dialog√≥w

## üìù Konwencje Kodowania

### Konwencje GDScript

```gdscript
# U≈ºywaj snake_case dla zmiennych i funkcji
var passenger_count = 0
var is_ticket_valid = false

# U≈ºywaj PascalCase dla klas i enum√≥w
class_name PassengerManager
enum TicketType { NORMAL, REDUCED, STUDENT }

# U≈ºywaj SCREAMING_SNAKE_CASE dla sta≈Çych
const MAX_STRESS_LEVEL = 100.0
const DEFAULT_FINE_AMOUNT = 280

# Jasna dokumentacja funkcji
## Waliduje bilet i zwraca true je≈õli jest wa≈ºny
## @param ticket: Zas√≥b biletu do walidacji
## @param passenger_data: PowiƒÖzane informacje o pasa≈ºerze
## @return: Boolean wskazujƒÖcy wa≈ºno≈õƒá biletu
func validate_ticket(ticket: Resource, passenger_data: Dictionary) -> bool:
    # Implementacja tutaj
    return true
```

### Organizacja Plik√≥w

**Struktura Sceny**
```
Node2D (G≈Ç√≥wna Scena)
‚îú‚îÄ‚îÄ Player (Kontroler gracza)
‚îú‚îÄ‚îÄ UI (Warstwa interfejsu u≈ºytkownika)
‚îÇ   ‚îú‚îÄ‚îÄ HUD (Heads-up display)
‚îÇ   ‚îú‚îÄ‚îÄ Journal (Podrƒôcznik referencyjny)
‚îÇ   ‚îî‚îÄ‚îÄ DialogueBox (UI konwersacji)
‚îú‚îÄ‚îÄ Passengers (Kontener pasa≈ºer√≥w)
‚îî‚îÄ‚îÄ Environment (T≈Ço i dekoracje)
```

**Konwencja Nazewnictwa Skrypt√≥w**
- Kontrolery scen: `scene_name.gd`
- Mened≈ºery system√≥w: `system_name_manager.gd`
- Klasy danych: `data_type.gd`
- Kontrolery UI: `ui_element_control.gd`

## üìä ZarzƒÖdzanie Danymi

### Struktura Danych Pasa≈ºera

```gdscript
# PassengerDataBus.gd - Globalne zarzƒÖdzanie pasa≈ºerami
extends Node

var passengers_data = []
var checked_passengers = []

# Struktura danych pasa≈ºera
var passenger_template = {
    "id": 0,
    "name": "",
    "surname": "",
    "address": "",
    "personality": PersonalityType.POLITE,
    "has_ticket": true,
    "ticket_type": TicketType.NORMAL,
    "has_valid_id": true,
    "stress_impact": 1.0
}
```

### Architektura Systemu Zapis√≥w

```gdscript
# Scripts/save_manager.gd
extends Node

const SAVE_FILE = "user://game_save.dat"

func save_game():
    var save_data = {
        "version": "1.0",
        "timestamp": Time.get_unix_time_from_system(),
        "player_data": get_player_state(),
        "game_progress": get_game_progress(),
        "settings": get_game_settings()
    }
    
    var file = FileAccess.open(SAVE_FILE, FileAccess.WRITE)
    file.store_string(JSON.stringify(save_data))
    file.close()

func load_game() -> bool:
    if not FileAccess.file_exists(SAVE_FILE):
        return false
    
    var file = FileAccess.open(SAVE_FILE, FileAccess.READ)
    var json_string = file.get_as_text()
    file.close()
    
    var json = JSON.new()
    var parse_result = json.parse(json_string)
    
    if parse_result != OK:
        return false
    
    apply_save_data(json.data)
    return true
```

## ‚öôÔ∏è System Konfiguracji

### Mened≈ºer Ustawie≈Ñ

```gdscript
# Scripts/settings_manager.gd
extends Node

signal settings_changed(setting_name: String, new_value)

var default_settings = {
    "language": "pl",
    "master_volume": 1.0,
    "music_volume": 0.8,
    "sfx_volume": 1.0,
    "screen_resolution": "1920x1080",
    "fullscreen": false,
    "vsync": true,
    "show_tutorial": true,
    "accessibility_high_contrast": false,
    "accessibility_text_size": 1.0
}

var current_settings = {}

func _ready():
    load_settings()
    apply_settings()

func set_setting(key: String, value):
    if key in current_settings:
        current_settings[key] = value
        settings_changed.emit(key, value)
        save_settings()
        apply_setting(key, value)

func apply_setting(key: String, value):
    match key:
        "language":
            TranslationServer.set_locale(value)
        "master_volume":
            AudioServer.set_bus_volume_db(0, linear_to_db(value))
        "fullscreen":
            if value:
                DisplayServer.window_set_mode(DisplayServer.WINDOW_MODE_FULLSCREEN)
            else:
                DisplayServer.window_set_mode(DisplayServer.WINDOW_MODE_WINDOWED)
```

### Sta≈Çe Gry

```gdscript
# Scripts/game_constants.gd
extends Node

# Balans Gry
const MAX_STRESS = 100.0
const STRESS_DECAY_RATE = 0.5
const STRESS_INCREASE_BASE = 10.0

# Kwoty Mandat√≥w (PLN)
const FINE_NO_TICKET = 280
const FINE_INVALID_TICKET = 280
const FINE_INVALID_DOCUMENT = 150

# Sta≈Çe Czasowe
const GAME_TIME_SCALE = 60.0  # 1 minuta = 1 sekunda
const SHIFT_DURATION_MINUTES = 480  # 8 godzin

# Typy Bilet√≥w
enum TicketType {
    NORMAL,
    REDUCED,
    STUDENT,
    SENIOR
}

# Osobowo≈õci Pasa≈ºer√≥w
enum PersonalityType {
    POLITE,
    OVERLY_POLITE,
    RUDE,
    FRAIDY
}

# Funkcje U≈ºytkowe
static func get_personality_stress_multiplier(personality: PersonalityType) -> float:
    var multipliers = {
        PersonalityType.POLITE: 1.0,
        PersonalityType.OVERLY_POLITE: 1.2,
        PersonalityType.RUDE: 2.0,
        PersonalityType.FRAIDY: 1.5
    }
    return multipliers.get(personality, 1.0)
```

## üîß Optymalizacja Wydajno≈õci

### Object Pooling dla Pasa≈ºer√≥w

```gdscript
# Scripts/passenger_pool.gd
extends Node

var passenger_scene = preload("res://Scenes/passenger.tscn")
var pool_size = 20
var available_passengers = []
var active_passengers = []

func _ready():
    initialize_pool()

func initialize_pool():
    for i in pool_size:
        var passenger = passenger_scene.instantiate()
        passenger.set_process(false)
        passenger.visible = false
        available_passengers.append(passenger)

func get_passenger() -> Node:
    var passenger
    if available_passengers.size() > 0:
        passenger = available_passengers.pop_back()
    else:
        passenger = passenger_scene.instantiate()
    
    active_passengers.append(passenger)
    passenger.set_process(true)
    passenger.visible = true
    return passenger

func return_passenger(passenger: Node):
    if passenger in active_passengers:
        active_passengers.erase(passenger)
        passenger.set_process(false)
        passenger.visible = false
        passenger.reset()  # Niestandardowa metoda resetowania stanu
        available_passengers.append(passenger)
```

## üêõ Obs≈Çuga B≈Çƒôd√≥w

### Solidne ZarzƒÖdzanie B≈Çƒôdami

```gdscript
# Scripts/error_handler.gd
extends Node

signal error_occurred(error_message: String, severity: ErrorSeverity)

enum ErrorSeverity {
    INFO,
    WARNING,
    ERROR,
    CRITICAL
}

func log_error(message: String, severity: ErrorSeverity = ErrorSeverity.ERROR):
    var timestamp = Time.get_datetime_string_from_system()
    var log_entry = "[%s] %s: %s" % [timestamp, ErrorSeverity.keys()[severity], message]
    
    print(log_entry)
    
    # Zapisz do pliku logu
    var log_file = FileAccess.open("user://error_log.txt", FileAccess.WRITE)
    if log_file:
        log_file.seek_end()
        log_file.store_line(log_entry)
        log_file.close()
    
    error_occurred.emit(message, severity)
    
    # Obs≈Çu≈º krytyczne b≈Çƒôdy
    if severity == ErrorSeverity.CRITICAL:
        handle_critical_error(message)

func handle_critical_error(message: String):
    # Zapisz awaryjny stan gry
    if has_method("emergency_save"):
        call("emergency_save")
    
    # Poka≈º dialog b≈Çƒôdu u≈ºytkownikowi
    var dialog = AcceptDialog.new()
    dialog.dialog_text = "WystƒÖpi≈Ç krytyczny b≈ÇƒÖd: %s\nGra zostanie zamkniƒôta." % message
    get_tree().current_scene.add_child(dialog)
    dialog.popup_centered()
    dialog.confirmed.connect(func(): get_tree().quit())
```

## üß™ Framework Testowania

### Struktura Test√≥w Jednostkowych

```gdscript
# Tests/unit/test_passenger_generation.gd
extends RefCounted

var passenger_generator

func before_each():
    passenger_generator = preload("res://Scripts/passenger_generator.gd").new()

func test_generate_passenger_with_valid_data():
    var passenger_data = passenger_generator.generate_passenger()
    
    assert(passenger_data.has("name"), "Pasa≈ºer powinien mieƒá imiƒô")
    assert(passenger_data.has("ticket_type"), "Pasa≈ºer powinien mieƒá typ biletu")
    assert(passenger_data["name"] != "", "Imiƒô pasa≈ºera nie powinno byƒá puste")

func test_stress_calculation():
    var base_stress = 10.0
    var personality_modifier = 1.5
    var expected_stress = base_stress * personality_modifier
    
    var calculated_stress = passenger_generator.calculate_stress_impact(
        GameConstants.PersonalityType.RUDE
    )
    
    assert(calculated_stress == expected_stress, "Nieprawid≈Çowe obliczenie stresu")
```

## üõ†Ô∏è Narzƒôdzia Debugowania

### Konsola Debug

```gdscript
# Scripts/debug_console.gd
extends CanvasLayer

var console_visible = false
var command_history = []

func _ready():
    visible = false

func _input(event):
    if event.is_action_pressed("toggle_debug_console"):
        toggle_console()

func execute_command(command: String):
    command_history.append(command)
    
    var parts = command.split(" ")
    var cmd = parts[0].to_lower()
    
    match cmd:
        "stress":
            if parts.size() > 1:
                var value = parts[1].to_float()
                get_node("/root/Game").set_stress(value)
                print("Stres ustawiony na: ", value)
        "spawn_passenger":
            get_node("/root/Game").spawn_debug_passenger()
            print("Debugowy pasa≈ºer utworzony")
        "reload_scene":
            get_tree().reload_current_scene()
        _:
            print("Nieznana komenda: ", cmd)
```

## üåê System Lokalizacji

### CSV-Based Translation System

```gdscript
# Scripts/localization_manager.gd
extends Node

var translations = {}
var current_language = "pl"

func _ready():
    load_translations()
    TranslationServer.set_locale(current_language)

func load_translations():
    var file = FileAccess.open("res://localization.csv", FileAccess.READ)
    if not file:
        push_error("Nie mo≈ºna za≈Çadowaƒá pliku lokalizacji")
        return
    
    # Pomi≈Ñ nag≈Ç√≥wek
    file.get_csv_line()
    
    while not file.eof_reached():
        var line = file.get_csv_line()
        if line.size() >= 4:
            var id = line[0]
            var context = line[1]
            var polish = line[2]
            var english = line[3]
            
            translations[id] = {
                "context": context,
                "pl": polish,
                "en": english
            }
    
    file.close()

func get_text(id: String, language: String = current_language) -> String:
    if id in translations:
        return translations[id].get(language, translations[id].get("pl", id))
    return id

func set_language(language: String):
    current_language = language
    TranslationServer.set_locale(language)
    # Wy≈õlij sygna≈Ç do aktualizacji wszystkich tekst√≥w UI
    get_tree().call_group("localizable", "update_text")
```

## üöÄ Proces Wk≈Çadu w Projekt

### Workflow Git

```bash
# Rozw√≥j funkcjonalno≈õci
git checkout -b feature/new-passenger-type
git commit -m "Dodaj typ pasa≈ºera senior√≥w ze specjalnƒÖ obs≈ÇugƒÖ"
git push origin feature/new-passenger-type

# Naprawy b≈Çƒôd√≥w
git checkout -b bugfix/stress-calculation-error
git commit -m "Napraw b≈ÇƒÖd przepe≈Çnienia w obliczaniu stresu"
git push origin bugfix/stress-calculation-error
```

### Proces Code Review

1. **Utw√≥rz branch funkcjonalno≈õci** z main
2. **Implementuj zmiany** zgodnie z wytycznymi stylu
3. **Napisz testy** dla nowej funkcjonalno≈õci
4. **Zaktualizuj dokumentacjƒô** wed≈Çug potrzeb
5. **Prze≈õlij pull request** z jasnym opisem
6. **Rozpatrz feedback** z przeglƒÖdu szybko

### Standardy Dokumentacji

- **Komentarze kodu** dla z≈Ço≈ºonej logiki
- **Dokumentacja funkcji** z parametrami i zwracanymi warto≈õciami
- **Aktualizacje README** dla nowych funkcji
- **Wpisy w changelog** dla wszystkich zmian

## üìÅ Struktura Plik√≥w Projektu

```
BiletNaWschod/
‚îú‚îÄ‚îÄ Assets/                 # Zasoby gry
‚îÇ   ‚îú‚îÄ‚îÄ Fonts/             # Czcionki
‚îÇ   ‚îú‚îÄ‚îÄ Music/             # Muzyka
‚îÇ   ‚îú‚îÄ‚îÄ SFX/               # Efekty d≈∫wiƒôkowe
‚îÇ   ‚îî‚îÄ‚îÄ Sprites/           # Grafiki
‚îú‚îÄ‚îÄ Scenes/                # Sceny Godot
‚îÇ   ‚îú‚îÄ‚îÄ ui/                # Sceny UI
‚îÇ   ‚îú‚îÄ‚îÄ gameplay/          # Sceny rozgrywki
‚îÇ   ‚îî‚îÄ‚îÄ menus/             # Sceny menu
‚îú‚îÄ‚îÄ Scripts/               # Skrypty GDScript
‚îÇ   ‚îú‚îÄ‚îÄ managers/          # Mened≈ºery system√≥w
‚îÇ   ‚îú‚îÄ‚îÄ ui/                # Kontrolery UI
‚îÇ   ‚îú‚îÄ‚îÄ gameplay/          # Logika rozgrywki
‚îÇ   ‚îî‚îÄ‚îÄ data/              # Klasy danych
‚îú‚îÄ‚îÄ Resources/             # Zasoby Godot (.tres)
‚îú‚îÄ‚îÄ Shaders/               # Niestandardowe shadery
‚îú‚îÄ‚îÄ Tests/                 # Testy automatyczne
‚îÇ   ‚îú‚îÄ‚îÄ unit/              # Testy jednostkowe
‚îÇ   ‚îî‚îÄ‚îÄ integration/       # Testy integracyjne
‚îú‚îÄ‚îÄ docs/                  # Dokumentacja
‚îî‚îÄ‚îÄ addons/                # Wtyczki Godot
```

## üîß Narzƒôdzia Rozwoju

### Zalecane Wtyczki Godot
- **Godot Tools** - Podstawowe narzƒôdzia developera
- **Todo Manager** - ZarzƒÖdzanie zadaniami w kodzie
- **Gut** - Framework testowania dla Godot

### Zewnƒôtrzne Narzƒôdzia
- **Aseprite** - Tworzenie sprite'√≥w z normal mapami
- **Git** - Kontrola wersji
- **Visual Studio Code** - Edytor kodu z wtyczkami GDScript

Ten przewodnik rozwoju zapewnia podstawƒô do utrzymywania i rozszerzania kodu "Bilet na Wsch√≥d" przy jednoczesnym zapewnieniu jako≈õci kodu i sp√≥jno≈õci projektu.

---

**Mi≈Çego kodowania! üíªüöÇ**