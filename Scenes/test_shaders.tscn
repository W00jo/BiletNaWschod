[gd_scene load_steps=8 format=3 uid="uid://c2mx6lnhhx1q8"]

[ext_resource type="PackedScene" uid="uid://bekremb8qkq02" path="res://Scenes/parallax_bg.tscn" id="1_t7xkq"]
[ext_resource type="Shader" uid="uid://c2r3d1yttau1x" path="res://Shaders/single_wipe.gdshader" id="2_7ub86"]
[ext_resource type="Texture2D" uid="uid://dgy2tokrhsr4c" path="res://Assets/Sprites/parallax_sky.png" id="3_3fhfs"]

[sub_resource type="ViewportTexture" id="ViewportTexture_mpqh8"]
viewport_path = NodePath("SubViewportContainer/SubViewport")

[sub_resource type="ShaderMaterial" id="ShaderMaterial_ct46q"]
resource_local_to_scene = true
shader = ExtResource("2_7ub86")
shader_parameter/under_texture = SubResource("ViewportTexture_mpqh8")
shader_parameter/wipe_progress = -1.0
shader_parameter/size = 0.637
shader_parameter/block_size = 2.0

[sub_resource type="Shader" id="Shader_5rm5r"]
code = "shader_type canvas_item;
uniform float amount: hint_range(1.0, 20.0, 1.0);
uniform sampler2D SCREEN_TEXTURE : hint_screen_texture, filter_linear_mipmap;

void fragment() 
{
	vec2 amt = 1.0 / amount / SCREEN_PIXEL_SIZE;
	vec2 uv = round(SCREEN_UV * amt) / amt;
	vec4 c = textureLod(SCREEN_TEXTURE, uv, 0);
	
	COLOR = c;
}"

[sub_resource type="ShaderMaterial" id="ShaderMaterial_2bmni"]
shader = SubResource("Shader_5rm5r")
shader_parameter/amount = 4.0

[node name="test_shaders" type="Control"]
layout_mode = 3
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2

[node name="SubViewportContainer" type="SubViewportContainer" parent="."]
layout_mode = 0
offset_right = 1920.0
offset_bottom = 1080.0

[node name="SubViewport" type="SubViewport" parent="SubViewportContainer"]
transparent_bg = true
canvas_item_default_texture_filter = 0
size = Vector2i(1920, 1080)

[node name="ParallaxBg" parent="SubViewportContainer/SubViewport" instance=ExtResource("1_t7xkq")]

[node name="TextureRect" type="TextureRect" parent="."]
material = SubResource("ShaderMaterial_ct46q")
layout_mode = 0
offset_right = 1920.0
offset_bottom = 1080.0
texture = ExtResource("3_3fhfs")

[node name="ColorRect" type="ColorRect" parent="."]
visible = false
material = SubResource("ShaderMaterial_2bmni")
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
